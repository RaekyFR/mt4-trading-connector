<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingView MT4 Bridge - Tableau de Bord</title>
    <link rel="stylesheet" href="https://assets.ubuntu.com/v1/vanilla-framework-version-4.26.1.min.css" />
    <style>
        /* Styles spécifiques trading */
        .status-indicator { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-left: 0.5rem; }
        .status-indicator.connected { background-color: #0e8420; }
        .status-indicator.disconnected { background-color: #c7162b; }
        .status-indicator.warning { background-color: #f99b11; }
        
        .position-pnl.positive { color: #0e8420; font-weight: 600; }
        .position-pnl.negative { color: #c7162b; font-weight: 600; }
        
        .navbar-fixed { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: white; border-bottom: 1px solid #d9d9d9; }
        .main-offset { margin-top: 4rem; }
        
        .position-card { margin-bottom: 0.5rem; border-left: 3px solid #0e8420; }
        .position-card.sell { border-left-color: #c7162b; }
        
        .action-buttons { gap: 0.25rem; }
        .action-buttons .p-button { padding: 0.25rem 0.5rem; font-size: 0.8rem; }
        
        .metric-value { font-size: 1.5rem; font-weight: 600; }
        .metric-label { color: #666; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; }
    </style>
</head>
<body>
    <!-- Navigation française -->
    <nav class="p-navigation navbar-fixed">
        <div class="p-navigation__row">
            <div class="p-navigation__banner">
                <div class="p-navigation__tagged-logo">
                    <span class="p-navigation__logo-tag">TV-MT4</span>
                    <span class="p-navigation__logo-title">Bridge</span>
                    <span class="status-indicator" id="statusIndicator"></span>
                </div>
            </div>
            <div class="p-navigation__nav">
                <ul class="p-navigation__items">
                    <li class="p-navigation__item is-selected">
                        <a class="p-navigation__link" href="#dashboard">Tableau de Bord</a>
                    </li>
                    <li class="p-navigation__item">
                        <a class="p-navigation__link" href="#strategies">Stratégies</a>
                    </li>
                    <li class="p-navigation__item">
                        <a class="p-navigation__link" href="#signals">Signaux</a>
                    </li>
                    <li class="p-navigation__item">
                        <a class="p-navigation__link" href="#orders">Ordres</a>
                    </li>
                    <li class="p-navigation__item">
                        <a class="p-navigation__link" href="#risk">Risques</a>
                    </li>
                    <li class="p-navigation__item">
                        <a class="p-navigation__link" href="#logs">Historique</a>
                    </li>
                </ul>
            </div>
            <div class="p-navigation__nav">
                <ul class="p-navigation__items">
                    <li class="p-navigation__item">
                        <button class="p-button--base has-icon" id="refreshBtn" title="Actualiser les données">
                            <i class="p-icon--restart"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenu principal épuré -->
    <main class="main-offset">
        <!-- En-tête avec actions principales -->
        <div class="p-strip is-shallow">
            <div class="row">
                <div class="col-8">
                    <h1 class="p-heading--2">Tableau de Bord Trading</h1>
                    <p class="p-text--small-caps">Surveillance et contrôle des positions MT4</p>
                </div>
                <div class="col-4 u-align--right">
                    <button class="p-button--negative" id="closeAllBtn">Tout Fermer</button>
                    <button class="p-button--base" id="systemRestartBtn">Redémarrer</button>
                </div>
            </div>
        </div>

        <!-- Barre de statut système -->
        <div class="p-strip is-shallow">
            <div class="row">
                <div class="col-12">
                    <div class="p-notification--information">
                        <div class="p-notification__content">
                            <div class="row">
                                <div class="col-3">
                                    <span class="p-text--small-caps">Connexion MT4</span><br>
                                    <span class="p-text--default" id="mt4StatusText">Connecté</span>
                                </div>
                                <div class="col-3">
                                    <span class="p-text--small-caps">Positions Ouvertes</span><br>
                                    <span class="p-text--default" id="openPositions">0</span>
                                </div>
                                <div class="col-3">
                                    <span class="p-text--small-caps">Signaux en Attente</span><br>
                                    <span class="p-text--default" id="pendingSignals">0</span>
                                </div>
                                <div class="col-3">
                                    <span class="p-text--small-caps">Dernière Mise à Jour</span><br>
                                    <span class="p-text--default" id="lastUpdate">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interface simplifiée -->
        <div class="p-strip is-shallow">
            <div class="row">
                <!-- Informations du compte -->
                <div class="col-4">
                    <div class="p-card">
                        <div class="p-card__header">
                            <h3 class="p-card__title">Compte MT4</h3>
                            <span class="status-indicator" id="accountStatus"></span>
                        </div>
                        <div class="p-card__content">
                            <div class="row">
                                <div class="col-6 u-align--center">
                                    <p class="metric-label">Balance</p>
                                    <p class="metric-value" id="balance">$0.00</p>
                                </div>
                                <div class="col-6 u-align--center">
                                    <p class="metric-label">Équité</p>
                                    <p class="metric-value" id="equity">$0.00</p>
                                </div>
                            </div>
                            <hr class="p-rule">
                            <div class="row">
                                <div class="col-6 u-align--center">
                                    <p class="metric-label">Marge</p>
                                    <p class="p-heading--5" id="margin">$0.00</p>
                                </div>
                                <div class="col-6 u-align--center">
                                    <p class="metric-label">Marge Libre</p>
                                    <p class="p-heading--5" id="freeMargin">$0.00</p>
                                </div>
                            </div>
                            <hr class="p-rule">
                            <div class="u-align--center">
                                <p class="metric-label">Niveau de Marge</p>
                                <p class="p-heading--4" id="marginLevel">0%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Positions actives avec contrôles -->
                <div class="col-8">
                    <div class="p-card">
                        <div class="p-card__header">
                            <h3 class="p-card__title">Positions Actives</h3>
                            <div>
                                <button class="p-button--negative is-dense" id="closeAllPositionsBtn" style="margin-right: 0.5rem;">Tout Fermer</button>
                                <button class="p-button--base is-dense" id="refreshPositions">Actualiser</button>
                            </div>
                        </div>
                        <div class="p-card__content">
                            <div id="positionsList">
                                <div class="p-text--muted u-align--center">
                                    <p>Chargement des positions...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Signaux récents -->
        <div class="p-strip is-shallow">
            <div class="row">
                <div class="col-12">
                    <div class="p-card">
                        <div class="p-card__header">
                            <h3 class="p-card__title">Signaux Récents</h3>
                            <a href="#signals" class="p-text--small">Voir Tous</a>
                        </div>
                        <div class="p-card__content">
                            <div id="signalsList">
                                <div class="p-text--muted u-align--center">
                                    <p>Chargement des signaux...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Zone de notifications -->
    <div id="notifications" style="position: fixed; top: 1rem; right: 1rem; z-index: 200; max-width: 400px;"></div>

    <!-- Modal pour modifier position -->
    <div class="p-modal" id="editPositionModal" style="display: none;">
        <div class="p-modal__dialog">
            <div class="p-modal__header">
                <h2 class="p-modal__title">Modifier Position</h2>
                <button class="p-modal__close" onclick="closeEditModal()">×</button>
            </div>
            <div class="p-modal__content">
                <div class="p-form-validation">
                    <div class="p-form-validation__field">
                        <label class="p-form-validation__label">Symbole</label>
                        <input class="p-form-validation__input" type="text" id="editSymbol" readonly>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <div class="p-form-validation__field">
                                <label class="p-form-validation__label">Stop Loss</label>
                                <input class="p-form-validation__input" type="number" id="editStopLoss" step="0.00001" placeholder="Nouveau SL">
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-form-validation__field">
                                <label class="p-form-validation__label">Take Profit</label>
                                <input class="p-form-validation__input" type="number" id="editTakeProfit" step="0.00001" placeholder="Nouveau TP">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-modal__footer">
                <button class="p-button--base" onclick="closeEditModal()">Annuler</button>
                <button class="p-button--positive" onclick="savePositionChanges()">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./js/api.js"></script>
    <script src="./js/components/navbar.js"></script>
    <script src="./js/components/notifications.js"></script>
    <script src="./js/dashboard.js"></script>
    <script src="./js/app.js"></script>
</body>
</html>